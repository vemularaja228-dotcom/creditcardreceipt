<script>
function calculate() {
  const amountAddedVal = document.getElementById("amountAdded").value;
  const bankAmountVal  = document.getElementById("bankAmount").value;
  const platformRate   = parseFloat(document.getElementById("platformRate").value) / 100;
  const fixedFee       = parseFloat(document.getElementById("fixedFee").value);
  const date           = new Date().toLocaleString();

  const amountAdded = amountAddedVal ? parseFloat(amountAddedVal) : NaN;
  const bankAmount  = bankAmountVal ? parseFloat(bankAmountVal) : NaN;

  let amount, platformFee, totalFee, bankSent, inputMode;

  // Case 1: Amount Added
  if (!isNaN(amountAdded) && isNaN(bankAmount)) {
    inputMode = "Amount Added by Customer";
    amount = amountAdded;
    platformFee = amount * platformRate;
    totalFee = platformFee + fixedFee;
    bankSent = amount - totalFee;

  // Case 2: Final Bank Amount
  } else if (isNaN(amountAdded) && !isNaN(bankAmount)) {
    inputMode = "Final Bank Amount Requested";
    bankSent = bankAmount;
    amount = (bankSent + fixedFee) / (1 - platformRate);
    platformFee = amount * platformRate;
    totalFee = platformFee + fixedFee;

  } else {
    alert("Please enter ONLY one value: Amount Added OR Final Bank Amount.");
    return;
  }

  const receiptText =
`-------------------------------
Siri Credit Card Services
Transaction Receipt
-------------------------------
Receipt Type : Credit Card to Bank Transfer
Input Mode   : ${inputMode}

Date & Time  : ${date}
Handled By   : Sagar
Contact      : 9959787923

-------------------------------
Amount Added : ₹${amount.toFixed(2)}
Platform %   : ${(platformRate * 100).toFixed(2)}%
Platform Fee : ₹${platformFee.toFixed(2)}
Fixed Fee    : ₹${fixedFee.toFixed(2)}
-------------------------------
Total Fee    : ₹${totalFee.toFixed(2)}
Net to Bank  : ₹${bankSent.toFixed(2)}
-------------------------------

Service Note:
This is a system-generated receipt.
Charges once processed are non-reversible.

-------------------------------
Our Services
• Credit Card Swiping
• Insurance (Life, Health, Vehicle)
• Credit Card Applications
-------------------------------

Thank you for choosing
Siri Credit Card Services
Please retain this receipt for reference.`;

  const box = document.getElementById("receiptOutput");
  box.style.display = "block";
  box.textContent = receiptText;
}

function shareWhatsApp() {
  const text = document.getElementById("receiptOutput").textContent.trim();
  if (!text) {
    alert("Please generate the receipt first.");
    return;
  }
  window.open("https://wa.me/?text=" + encodeURIComponent(text), "_blank");
}

function downloadReceipt() {
  html2canvas(document.getElementById("receiptOutput")).then(canvas => {
    const link = document.createElement("a");
    link.download = "Siri_Transaction_Receipt.png";
    link.href = canvas.toDataURL();
    link.click();
  });
}
</script>
