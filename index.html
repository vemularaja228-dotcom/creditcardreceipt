<script>
document.addEventListener("DOMContentLoaded", function () {

  window.calculate = function () {
    var amountAddedVal = document.getElementById("amountAdded").value;
    var bankAmountVal  = document.getElementById("bankAmount").value;
    var rateVal        = document.getElementById("platformRate").value;
    var fixedVal       = document.getElementById("fixedFee").value;

    var rate  = parseFloat(rateVal) / 100;
    var fixed = parseFloat(fixedVal);

    var amountAdded = amountAddedVal ? parseFloat(amountAddedVal) : NaN;
    var bankAmount  = bankAmountVal ? parseFloat(bankAmountVal) : NaN;

    var amount, platformFee, totalFee, bankSent, inputMode;

    if (!isNaN(amountAdded) && isNaN(bankAmount)) {
      inputMode = "Amount Added by Customer";
      amount = amountAdded;
      platformFee = amount * rate;
      totalFee = platformFee + fixed;
      bankSent = amount - totalFee;

    } else if (isNaN(amountAdded) && !isNaN(bankAmount)) {
      inputMode = "Final Bank Amount Requested";
      bankSent = bankAmount;
      amount = (bankSent + fixed) / (1 - rate);
      platformFee = amount * rate;
      totalFee = platformFee + fixed;

    } else {
      alert("Please enter ONLY one value.");
      return;
    }

    var receiptText =
"-------------------------------\n" +
"Siri Credit Card Services\n" +
"Transaction Receipt\n" +
"-------------------------------\n" +
"Input Mode   : " + inputMode + "\n" +
"Date & Time  : " + new Date().toLocaleString() + "\n" +
"Handled By   : Sagar\n" +
"Contact      : 9959787923\n\n" +
"Amount Added : ₹" + amount.toFixed(2) + "\n" +
"Platform %   : " + (rate * 100).toFixed(2) + "%\n" +
"Platform Fee : ₹" + platformFee.toFixed(2) + "\n" +
"Fixed Fee    : ₹" + fixed.toFixed(2) + "\n" +
"-------------------------------\n" +
"Total Fee    : ₹" + totalFee.toFixed(2) + "\n" +
"Net to Bank  : ₹" + bankSent.toFixed(2) + "\n" +
"-------------------------------\n" +
"Thank you for choosing Siri Credit Card Services.";

    var box = document.getElementById("receiptOutput");
    box.style.display = "block";
    box.textContent = receiptText;
  };

  window.shareWhatsApp = function () {
    var text = document.getElementById("receiptOutput").textContent.trim();
    if (!text) {
      alert("Please generate the receipt first.");
      return;
    }
    window.open("https://wa.me/?text=" + encodeURIComponent(text), "_blank");
  };

});
</script>
